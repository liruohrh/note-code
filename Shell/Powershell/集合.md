# å¯åŠ¨åå°ç¨‹åº
- ä¸è¦`-NoNewWindow `è€Œæ˜¯è¦ `-WindowStyle Hidden`
	- NoNewWindowä¼šå¯¼è‡´éœ€è¦ `taskkill /f`æ‰èƒ½åœæ­¢è¿›ç¨‹

```powershell
# 1. å®šä¹‰åŸºç¡€é…ç½®ï¼ˆæ–¹ä¾¿åç»­ä¿®æ”¹ï¼‰
$exePath = ".\xxxx.exe"
$logRootDir = ".\logs\std"  # æ—¥å¿—æ ¹ç›®å½•
$timestamp = Get-Date -Format "yyyy-MM-dd"  # ç”Ÿæˆæ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰
$stdoutLog = Join-Path -Path $logRootDir -ChildPath "${timestamp}_output.log"
$stderrLog = Join-Path -Path $logRootDir -ChildPath "${timestamp}_error.log"

# 2. è‡ªåŠ¨åˆ›å»ºæ—¥å¿—ç›®å½•ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œé¿å…æŠ¥é”™ï¼‰
if (-not (Test-Path -Path $logRootDir)) {
    New-Item -Path $logRootDir -ItemType Directory -Force | Out-Null
    Write-Host "æ—¥å¿—ç›®å½•å·²åˆ›å»ºï¼š$logRootDir"
}

# 3. æ ¡éªŒå¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆé¿å…å¯åŠ¨å¤±è´¥ï¼‰
if (-not (Test-Path -Path $exePath -PathType Leaf)) {
    Write-Error "é”™è¯¯ï¼šå¯æ‰§è¡Œæ–‡ä»¶ä¸å­˜åœ¨ â†’ $exePath"
    exit 1
}

# # æ‰©å±•ï¼šè‡ªåŠ¨æ¸…ç†7å¤©å‰çš„æ—¥å¿—ï¼ˆå¯é€‰ï¼‰
# $maxLogAge = 7  # ä¿ç•™7å¤©å†…çš„æ—¥å¿—
# Get-ChildItem -Path $logRootDir -Filter "*.log" | Where-Object {
#     $_.LastWriteTime -lt (Get-Date).AddDays(-$maxLogAge)
# } | Remove-Item -Force -ErrorAction SilentlyContinue
# Write-Host "å·²æ¸…ç† $maxLogAge å¤©å‰çš„æ—§æ—¥å¿—"

# 4. å¯åŠ¨ç¨‹åºï¼ˆåå°è¿è¡Œï¼Œé‡å®šå‘æ—¥å¿—ï¼‰
try {
    Start-Process -FilePath $exePath `
                  -RedirectStandardOutput $stdoutLog `
                  -RedirectStandardError $stderrLog `
                  -WindowStyle Hidden `
                  -PassThru | Out-Null  # è¿”å›è¿›ç¨‹å¯¹è±¡ä½†ä¸è¾“å‡ºï¼Œä¾¿äºåç»­æ‰©å±•
    
    Write-Host "startï¼š ç¨‹åºå·²åå°å¯åŠ¨ï¼"
    Write-Host "æ ‡å‡†è¾“å‡ºæ—¥å¿—ï¼š$stdoutLog"
    Write-Host "é”™è¯¯è¾“å‡ºæ—¥å¿—ï¼š$stderrLog"
}
catch {
    Write-Error "ç¨‹åºå¯åŠ¨å¤±è´¥ï¼š$_"
    exit 1
}

```


# è‡ªåŠ¨ææƒç®¡ç†å‘˜
```powershell
# 1. æ£€æµ‹å½“å‰æ˜¯å¦ä¸ºç®¡ç†å‘˜æƒé™
$currentPrincipal = New-Object Security.Principal.WindowsPrincipal([Security.Principal.WindowsIdentity]::GetCurrent())
$isAdmin = $currentPrincipal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
  
# 2. éç®¡ç†å‘˜åˆ™è‡ªåŠ¨ææƒé‡å¯è„šæœ¬
if (-not $isAdmin) {
Â  Â  # æ„å»ºææƒå¯åŠ¨å‚æ•°ï¼š-NoProfileï¼ˆä¸åŠ è½½ç”¨æˆ·é…ç½®ï¼‰ã€-ExecutionPolicy Bypassï¼ˆç»•è¿‡æ‰§è¡Œç­–ç•¥ï¼‰ã€-Fileï¼ˆæŒ‡å®šè¿è¡Œè„šæœ¬æ–‡ä»¶ï¼‰
Â  Â  $arguments = "-NoProfile -ExecutionPolicy Bypass -File `"$($MyInvocation.MyCommand.Definition)`""
Â  Â  # åˆ›å»ºç®¡ç†å‘˜æƒé™çš„è¿›ç¨‹å¯åŠ¨ä¿¡æ¯
Â  Â  $processStartInfo = New-Object System.Diagnostics.ProcessStartInfo
Â  Â  $processStartInfo.FileName = "powershell.exe"
Â  Â  $processStartInfo.Arguments = $arguments
Â  Â  $processStartInfo.Verb = "runas" Â # å…³é”®ï¼šæŒ‡å®šä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
Â  Â  $processStartInfo.WindowStyle = [System.Diagnostics.ProcessWindowStyle]::Normal
Â  Â  try {
Â  Â  Â  Â  # å¯åŠ¨ææƒè¿›ç¨‹ï¼Œä¼šå¼¹å‡ºUACç”¨æˆ·è´¦æˆ·æ§åˆ¶å¼¹çª—
Â  Â  Â  Â  [System.Diagnostics.Process]::Start($processStartInfo) | Out-Null
Â  Â  }
Â  Â  catch {
Â  Â  Â  Â  Write-Host "âŒ ææƒå¤±è´¥ï¼ä½ æ‹’ç»äº†ç®¡ç†å‘˜æƒé™è¯·æ±‚ï¼Œè„šæœ¬æ— æ³•æ‰§è¡Œã€‚" -ForegroundColor Red
Â  Â  Â  Â  Pause
Â  Â  Â  Â  exit 1
Â  Â  }
Â  Â  # åŸéç®¡ç†å‘˜è¿›ç¨‹é€€å‡ºï¼Œä»…ä¿ç•™ææƒåçš„æ–°è¿›ç¨‹
Â  Â  exit 0
}
# 3. ç®¡ç†å‘˜æƒé™ä¸‹æ‰§è¡ŒåŸæœ‰æ ¸å¿ƒåŠŸèƒ½
Write-Host "ğŸ”‘ å·²è·å–ç®¡ç†å‘˜æƒé™ï¼Œè„šæœ¬æ­£å¸¸æ‰§è¡Œ..." -ForegroundColor Green

```

# å®æ—¶å…³é—­windowså®æ—¶ä¿æŠ¤

```powershell

$isAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
if (-not $isAdmin) {
    Write-Host "âš ï¸ è¯·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæ­¤è„šæœ¬ï¼" -ForegroundColor Red
    Pause
    exit
}

Write-Host "ğŸ” å¼€å§‹æ¯ 5 ç§’å…³é—­ä¸€æ¬¡ Windows Defender å®æ—¶ä¿æŠ¤..." -ForegroundColor Cyan

while ($true) {
    try {
        Set-MpPreference -DisableRealtimeMonitoring $true -ErrorAction Stop
        Write-Host "$(Get-Date -Format 'HH:mm:ss') - å®æ—¶ä¿æŠ¤å·²å…³é—­ã€‚"
    }
    catch {
        Write-Host "$(Get-Date -Format 'HH:mm:ss') - å…³é—­å¤±è´¥: $($_.Exception.Message)" -ForegroundColor Yellow
    }

    Start-Sleep -Seconds 5
}

<# æ‰“å¼€ï¼š

Set-MpPreference -DisableRealtimeMonitoring $false 

#>

```